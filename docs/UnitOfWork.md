# 工作单元

在业务系统开发过程中经常遇到一个业务功能需要对数据库进行多种持久化改变，而这个一系列的改变通常需要在一个事务中完成，这就是工作单元要完成的事情。

工作单元该是什么样子的，在一个业务功能的开始应该有一个工作单元被创建出来，在业务的结束，工作单元应该被提交，而工作单元的中间过程应该是由具体的实现来完成，我将这个实现称为[仓储](Repository.md).

### 工作单元中编程风格构想

我认为工作单元有一下两种编程模型，但都不能达到满意的效果。

#### 显式创建

需要显示的创建工作单元，编程风格上不是很好，需要关心工作单元的执行状态

```php

//创建工作单元
$uow=new UnitOfWork();
//向工作单元添加一些工作内容
$uow->addWork("doing something...");
$uow->addWork('doing something...');
......
//提交工作单，保证工作单元的原子性
$uow->commit();

```

#### 隐式创建

只需要执行工作而不需要关心工作单元，编程模型上只需要关心业务中的各个模块的执行，而不需要关心工作单元的执行状态，工作单元在后台自动的begin和commit

```php
$r1=Repository::createRepository(type1);
$r2=Repository::createRepository(type2);
.......
//因为php是单线运行的，所以在Repository内部维护者事务的begin和end并不是很困难
Repository::save();
```

